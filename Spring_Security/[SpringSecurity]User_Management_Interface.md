![Untitled](./images/security01.png)

# UserDatailsService

> **ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”** í•µì‹¬ì ì¸ ì¸í„°í˜ì´ìŠ¤
> 
- `loadUserByUsername`ì´ë¼ëŠ” ë‹¨ì¼ ë©”ì„œë“œê°€ ì¡´ì¬í•œë‹¤.

![Untitled](./images/security02.png)

### Q. ì™œ usernameê³¼ password ë‘˜ ë‹¤ ì‚¬ìš©í•˜ì§€ ì•Šê³ , usernameë§Œ ì‚¬ìš©í• ê¹Œ?

ğŸ’¡ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¶ˆí•„ìš”í•˜ê²Œ ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡í•´ì„œëŠ” ì•ˆë˜ê¸° ë•Œë¬¸ì´ë‹¤.** <br>
â‡’ ë‚˜ì¤‘ì— passwordë¥¼ ë¹„êµí•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆê³ , ê·¸ì— ë”°ë¼ ì¸ì¦ì´ ì„±ê³µí–ˆëŠ”ì§€ ì—¬ë¶€ì— ë”°ë¼ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆë‹¤.



# UserDetailsManager

> ì‚¬ìš©ì ì„¸ë¶€ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
> 

![Untitled](./images/security03.png)

â‡’ DBë‚˜ ì €ì¥ ì‹œìŠ¤í…œì—ì„œ ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ ì™¸ì—ë„ ìƒˆë¡œìš´ ìœ ì €ë¥¼ ìƒì„±í•˜ê±°ë‚˜, ì—…ë°ì´íŠ¸, ì‚­ì œí•˜ëŠ” ë©”ì„œë“œë„ í¬í•¨í•˜ê³  ìˆë‹¤. 

ì´ë¥¼ Spring Security ìì²´ì—ì„œ ì„¸ë¶€ì ìœ¼ë¡œ êµ¬í˜„í•´ ë†“ì€ ê²ƒì´ ë‹¤ìŒê³¼ ê°™ì€ 3ê°€ì§€ì´ë‹¤.

1. `InMemoryUserDetailsManger`
2. `JdbcUserDetailsManager`
3. `LdapUserDetailsManager`

â‡’ Spring Securityì—ì„œ ì œê³µí•˜ëŠ” ì„¸ ê°€ì§€ **êµ¬í˜„ í´ë˜ìŠ¤**


ğŸ’¡ ë§Œì•½, ìì²´ ì¸ì¦ ë¡œì§ì´ ì¡´ì¬í•˜ê±°ë‚˜ ëª¨ë“  ê²ƒì„ ì§ì ‘ ì‘ì„±í•˜ë ¤ëŠ” ê²½ìš°ì—ëŠ” ìì²´ `AuthenticationProvider`ë¥¼ ì •ì˜í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ ì•ˆì—ì„œ ìì²´ ë¡œì§ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.  
í•˜ì§€ë§Œ, í˜„ì¬ëŠ” `DaoAuthenticationProvider`ë¼ëŠ” ê¸°ë³¸ `AuthenticationProvider`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— Spring Securityì—ì„œ ì œê³µí•˜ëŠ” êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.


# UserDetails

> **ì‚¬ìš©ìì˜ ì„¸ë¶€ ì •ë³´**ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ***ì¸í„°í˜ì´ìŠ¤***
> 

![Untitled](./images/security04.png)

â‡’ ì¸í„°í˜ì´ìŠ¤ì´ê¸° ë•Œë¬¸ì— `User` ë¼ëŠ” **êµ¬í˜„ í´ë˜ìŠ¤**ë¥¼ ì œê³µí•œë‹¤.

![Untitled](./images/security05.png)

### getAuthorities

> ì‚¬ìš©ìì—ê²Œ ë¶€ì—¬ëœ ëª¨ë“  ê¶Œí•œì„ ë°˜í™˜
> 
- ì‚¬ìš©ìì˜ ê¶Œí•œ ë˜ëŠ” ì—­í•  ëª©ë¡ì„ ë³´ìœ í•˜ê³  ìˆë‹¤.

â‡’ ì´ë¥¼ ì‚¬ìš©í•´ **ì¸ê°€** or **ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ë©”ì»¤ë‹ˆì¦˜ì„ êµ¬í˜„**í•  ìˆ˜ ìˆë‹¤.

### getPassword

> ì‚¬ìš©ìë¥¼ ì¸ì¦í•˜ëŠ”ë° ì‚¬ìš©ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°˜í™˜
> 

### getUsername

> ì‚¬ìš©ìì˜ ì´ë¦„ì„ ë°˜í™˜
> 

### isAccountNonExpired

> ì‚¬ìš©ì **ê³„ì •**ì´ ìœ íš¨í•˜ë©° ë§Œë£Œë˜ì§€ ì•Šì•˜ì„ ê²½ìš°, `true`ë¥¼ ë°˜í™˜
> 

### isAccountNonLocked

> ì‚¬ìš©ì ê³„ì •ì´ ì ê¸°ì§€ ì•Šì•˜ì„ ê²½ìš°, `true`ë¥¼ ë°˜í™˜
> 

### isCredentialsNonExpired

> ì‚¬ìš©ìì˜ Credential(ì¸ì¦ì •ë³´, ë¹„ë°€ë²ˆí˜¸ â€¦)ì´ ë§Œë£Œë˜ì§€ ì•Šì•˜ì„ ê²½ìš°, `true`ë¥¼ ë°˜í™˜
> 

### isEnabled

> ì‚¬ìš©ìì˜ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë°˜í™˜
> 

# User

> `UserDetails`ì˜ êµ¬í˜„ í´ë˜ìŠ¤
> 
- `UserDetails` ì˜ ëª¨ë“  í´ë˜ìŠ¤ê°€ Override ë˜ì–´ ìˆë‹¤.

# loadUserByUsername

ì•„ë˜ëŠ” `InMemoryUserDetailsManager` í´ë˜ìŠ¤ ì•ˆì— ìˆëŠ” `loadUserByUsername` ë©”ì„œë“œì´ë‹¤.

![Untitled](./images/security06.png)

- `UserDetails`ë¥¼ ë°˜í™˜í•œë‹¤.
- `UserDetailsService` ì¸í„°í˜ì´ìŠ¤ì— ì˜í•´ Override ë˜ì—ˆë‹¤.

```java
private final Map<String, MutableUserDetails> users = new HashMap<>();
```

ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ `users`ê°€ Mapìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , `username`ì„ **Key ê°’**ìœ¼ë¡œ ì°¾ì•„ì˜¤ëŠ” ê³¼ì •ì„ ìˆ˜í–‰í•œë‹¤.

---

![Untitled](./images/security07.png)

### UserDetails & User

> `UserDetails`ì™€ `User`ëŠ” ì‚¬ìš©ìì˜ ì„¸ë¶€ ì •ë³´ë¥¼ DB ë“±ì˜ ì €ì¥ ì‹œìŠ¤í…œì—ì„œ ë¡œë“œí•˜ë ¤ê³  í•  ë•Œ ì‚¬ìš©ëœë‹¤.
> 

â‡’ íŠ¹íˆ `UserDetailsService`ì™€ `UserDetailsManager`ì¸í„°í˜ì´ìŠ¤ ë° êµ¬í˜„ í´ë˜ìŠ¤ ë‚´ì—ì„œ ì‚¬ìš©ëœë‹¤.

ì´ ì„¸ë¶€ ì •ë³´ë“¤ì€ `AuthenticationProvider`ì— ì „ë‹¬ëœë‹¤. `AuthenticationProvider` ë‚´ì—ì„œ ì¸ì¦ì´ ì„±ê³µí•˜ë©´, ëª¨ë“  ì •ë³´ì™€ í•¨ê»˜ ì„±ê³µì ì¸ ì¸ì¦ ì„¸ë¶€ ì •ë³´ë¥¼ ì¸ì¦ ê°ì²´ ë°ì´í„° ìœ í˜•ìœ¼ë¡œ ë³€í™˜í•œë‹¤. 

### Authentication

![Untitled](./images/security08.png)

- `Principal`í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê³  ìˆë‹¤.
- `isAuthenticated` ë©”ì„œë“œë¥¼ í†µí•´ì„œ **ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ë˜ì—ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸**í•  ìˆ˜ ìˆë‹¤.